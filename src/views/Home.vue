<template>
  <div class="home">
    <left-nav-bar @applyFilter="changeFilter" :lists="lists"></left-nav-bar>
    <div class="list-lists">
      <add-list-form @addList="addList"></add-list-form>
      <div v-if="filter == null || filter == ''">
        <div v-for="list in nonDeletedLists" :key="list.id" class="list">
          <list :list="list" @addElement="addElementToList" @removeList="deleteList" @changeElementStatus="saveDatasInLocalStorage"></list>
        </div>
      </div>
      <div v-else>
        <div v-for="list in filteredList" :key="list.id" class="list">
          <list-detail  :list="list" @addElement="addElementToList" @removeList="deleteList" @changeElementStatus="saveDatasInLocalStorage" @restoreList="saveDatasInLocalStorage" ></list-detail>
        </div>
      </div>
    </div>
  </div>
</template>
<style>
  li{
    list-style: none;
    cursor: pointer;
  }
  .complete{
    text-decoration: line-through;
    color: rgb(128, 123, 123);
  }
</style>
<script>
import AddListForm from '../components/AddListForm.vue';
import LeftNavBar from '../components/LeftNavBar.vue'
import List from '../components/List.vue';
import ListDetail from '../components/ListDetail.vue';

export default {
  name: 'Home',
  components: {
    LeftNavBar,
    AddListForm,
    List,
    ListDetail
  },
  beforeMount(){
    if(localStorage.getItem("savedList")){
      this.lists = JSON.parse(localStorage.getItem("savedList"));
    }
    else{
      this.saveDatasInLocalStorage();
    }
  },
  methods:{
    changeFilter(value){
      this.filter = value;
    },
    saveDatasInLocalStorage(){
      let stringnifyLists = JSON.stringify(this.lists);
      localStorage.setItem("savedList", stringnifyLists);
    },
    deleteList(e){
      this.lists[e.target.dataset.pos].deletionDate = this.currentDate;
      this.saveDatasInLocalStorage();
    },
    addElementToList(e){
      if(e.target.value != ""){
        this.lists[e.target.dataset.pos].elements.push(
        {
          id: this.lists[e.target.dataset.pos].elements.length,
          title: e.target.value,
          isCompleted:false
        }
      );
      e.target.value = "";
      this.saveDatasInLocalStorage();
      }
    },
    addList(e){
      this.lists.push(
        {
          id: this.lists.length,
          name : document.querySelector("#name").value,
          description : document.querySelector("#description").value,
          creationDate : this.currentDate,
          deletionDate : null,
          elements : []
        } 
      )
      this.saveDatasInLocalStorage();
    }
  },
  computed:{
    nonDeletedLists(){
      return this.lists.filter((list)=>{
        return list.deletionDate == null;
      });
    },
    currentDate(){
      let now = new Date();
      return now.getFullYear()+'-'+(now.getMonth()+1)+'-'+now.getDate();
    },
    filteredList(){
      return this.lists.filter((list)=>{
        return list.name.includes(this.filter);
      }); 
    }
  },
  data(){ 
    return {
      filter : null,
      lists : [
        {
          id:0,
          name: "lire",
          description : "exemple d'utilisation de l'application",
          deletionDate : null,
          creationDate : "2021-10-25",
          elements:[
            {
              id:0,
              title: "livre 1",
              isCompleted: true
            },
            {
              id:1,
              title: "livre 2",
              isCompleted: false
            },
            {
              id:2,
              title: "livre 3",
              isCompleted: false
            }
          ]
        },
        {
          id:1,
          name: "tâches",
          description : "exemple d'utilisation de l'application",
          deletionDate : null,
          creationDate : "2021-10-25",
          elements:[
            {
              id:0,
              title: "lessive",
              isCompleted: false
            },
            {
              id:1,
              title: "vaissel",
              isCompleted: false
            },
            {id:2,
              title: "cuisine",
              isCompleted: false
            }
          ]
        },
        {
          id:2,
          name: "épicerie",
          description : "exemple d'utilisation de l'application",
          deletionDate : null,
          creationDate : "2021-10-25",
          elements:[
            {
              id:0,
              title: "Lait",
              isCompleted: false
            },
            {
              id:1,
              title: "Pain",
              isCompleted: false
            },
            {
              id:2,
              title: "Beurre d'arachide",
              isCompleted: false
            }
          ]
        },
      ]

    }
    
  }
}
</script>
